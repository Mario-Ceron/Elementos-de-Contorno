import numpy as np
gauss_legendre_table = {
    2: {
        "xi": np.array([
            -0.577350269189626, 
             0.577350269189626
        ]),
        "wi": np.array([
             1.000000000000000,
             1.000000000000000
        ]),
    },
    3: {
        "xi": np.array([
            -0.774596669241483,
             0.000000000000000,
             0.774596669241483
        ]),
        "wi": np.array([
             0.555555555555556,
             0.888888888888889,
             0.555555555555556
        ]),
    },
    4: {
        "xi": np.array([
            -0.861136311594053,
            -0.339981043584856,
             0.339981043584856,
             0.861136311594053
        ]),
        "wi": np.array([
             0.347854845137454,
             0.652145154862546,
             0.652145154862546,
             0.347854845137454
        ]),
    },
    5: {
        "xi": np.array([
            -0.906179845938664,
            -0.538469310105683,
             0.000000000000000,
             0.538469310105683,
             0.906179845938664
        ]),
        "wi": np.array([
             0.236926885056189,
             0.478628670499366,
             0.568888888888889,
             0.478628670499366,
             0.236926885056189
        ]),
    },
    6: {
        "xi": np.array([
            -0.932469514203152,
            -0.661209386466265,
            -0.238619186083197,
             0.238619186083197,
             0.661209386466265,
             0.932469514203152
        ]),
        "wi": np.array([
             0.171324492379170,
             0.360761573048139,
             0.467913934572691,
             0.467913934572691,
             0.360761573048139,
             0.171324492379170
        ]),
    },
    7: {
        "xi": np.array([
            -0.949107912342759,
            -0.741531185599394,
            -0.405845151377397,
             0.000000000000000,
             0.405845151377397,
             0.741531185599394,
             0.949107912342759
        ]),
        "wi": np.array([
             0.129484966168870,
             0.279705391489277,
             0.381830050505119,
             0.417959183673469,
             0.381830050505119,
             0.279705391489277,
             0.129484966168870
        ]),
    },
    8: {
        "xi": np.array([
            -0.960289856497536, 
            -0.796666477413627, 
            -0.525532409916329, 
            -0.183434642495650, 
             0.183434642495650, 
             0.525532409916329, 
             0.796666477413627, 
             0.960289856497536  
        ]),
        "wi": np.array([
             0.101228536290376,
             0.222381034453374,
             0.313706645877887,
             0.362683783378362,
             0.362683783378362,
             0.313706645877887,
             0.222381034453374,
             0.101228536290376
        ]),
    },
    9: {
        "xi": np.array([
            -0.968160239507626, 
            -0.836031107326636, 
            -0.613371432700590, 
            -0.324253423403809, 
             0.000000000000000, 
             0.324253423403809, 
             0.613371432700590, 
             0.836031107326636, 
             0.968160239507626  
        ]),
        "wi": np.array([
             0.081274388361574,
             0.180648160694857,
             0.260610696402935,
             0.312347077040003,
             0.330239355001260,
             0.312347077040003,
             0.260610696402935,
             0.180648160694857,
             0.081274388361574
        ]),
    },
    10: {
        "xi": np.array([
            -0.973906528517172, 
            -0.865063366688985, 
            -0.679409568299024, 
            -0.433395394129247, 
            -0.148874338981631, 
             0.148874338981631, 
             0.433395394129247, 
             0.679409568299024, 
             0.865063366688985, 
             0.973906528517172  
        ]),
        "wi": np.array([
             0.066671344308688,
             0.149451349150581,
             0.219086362515982,
             0.269266719309996,
             0.295524224714753,
             0.295524224714753,
             0.269266719309996,
             0.219086362515982,
             0.149451349150581,
             0.066671344308688
        ]),
    },
    12: {
        "xi": np.array([
            -0.981560634246719, 
            -0.904117256370475, 
            -0.769902674194305, 
            -0.587317954286617, 
            -0.367831498998180, 
            -0.125233408511469, 
             0.125233408511469, 
             0.367831498998180, 
             0.587317954286617, 
             0.769902674194305, 
             0.904117256370475, 
             0.981560634246719  
        ]),
        "wi": np.array([
             0.047175336386512,
             0.106939325995318,
             0.160078328543346,
             0.203167426723066,
             0.233492536538355,
             0.249147045813403,
             0.249147045813403,
             0.233492536538355,
             0.203167426723066,
             0.160078328543346,
             0.106939325995318,
             0.047175336386512
        ]),
    },
    16: {
        "xi": np.array([
            -9.894009349916499E-01,
            -9.445750230732326E-01,
            -8.656312023878318E-01,
            -7.554044083550030E-01,
            -6.178762444026438E-01,
            -4.580167776572274E-01,
            -2.816035507792589E-01,
            -9.501250983763744E-02,
             9.501250983763744E-02,
             2.816035507792589E-01,
             4.580167776572274E-01,
             6.178762444026438E-01,
             7.554044083550030E-01,
             8.656312023878318E-01,
             9.445750230732326E-01,
             9.894009349916499E-01
        ]),
        "wi": np.array([
             2.715245941175410E-02,
             6.225352393864789E-02,
             9.515851168249279E-02,
             1.246289712555339E-01,
             1.495959888165767E-01,
             1.691565193950025E-01,
             1.826034150449236E-01,
             1.894506104550685E-01,
             1.894506104550685E-01,
             1.826034150449236E-01,
             1.691565193950025E-01,
             1.495959888165767E-01,
             1.246289712555339E-01,
             9.515851168249279E-02,
             6.225352393864789E-02,
             2.715245941175410E-02
        ]),
    },
    32: {
        "xi": np.array([
            -9.972638618494816E-01,
            -9.856115115452684E-01,
            -9.647622555875064E-01,
            -9.349060759377397E-01,
            -8.963211557660521E-01,
            -8.493676137325700E-01,
            -7.944837959679424E-01,
            -7.321821187402897E-01,
            -6.630442669302152E-01,
            -5.877157572407623E-01,
            -5.068999089322294E-01,
            -4.213512761306353E-01,
            -3.318686022821277E-01,
            -2.392873622521371E-01,
            -1.444719615827965E-01,
            -4.830766568773832E-02,
             4.830766568773832E-02,
             1.444719615827965E-01,
             2.392873622521371E-01,
             3.318686022821277E-01,
             4.213512761306353E-01,
             5.068999089322294E-01,
             5.877157572407623E-01,
             6.630442669302152E-01,
             7.321821187402897E-01,
             7.944837959679424E-01,
             8.493676137325700E-01,
             8.963211557660521E-01,
             9.349060759377397E-01,
             9.647622555875064E-01,
             9.856115115452684E-01,
             9.972638618494816E-01,
        ]),
        "wi": np.array([
            7.018610009470096E-03,
            1.627439473090567E-02,
            2.539206530926206E-02,
            3.427386291302143E-02,
            4.283589802222668E-02,
            5.099805926237617E-02,
            5.868409347853554E-02,
            6.582222277636185E-02,
            7.234579410884850E-02,
            7.819389578707031E-02,
            8.331192422694675E-02,
            8.765209300440381E-02,
            9.117387869576389E-02,
            9.384439908080457E-02,
            9.563872007927486E-02,
            9.654008851472780E-02,
            9.654008851472780E-02,
            9.563872007927486E-02,
            9.384439908080457E-02,
            9.117387869576389E-02,
            8.765209300440381E-02,
            8.331192422694675E-02,
            7.819389578707031E-02,
            7.234579410884850E-02,
            6.582222277636185E-02,
            5.868409347853554E-02,
            5.099805926237617E-02,
            4.283589802222668E-02,
            3.427386291302143E-02,
            2.539206530926206E-02,
            1.627439473090567E-02,
            7.018610009470096E-03,
        ]),
    },
    48: {
        "xi": np.array([
            -9.987710072524261E-01,
            -9.935301722663508E-01,
            -9.841245837228269E-01,
            -9.705915925462473E-01,
            -9.529877031604309E-01,
            -9.313866907065543E-01,
            -9.058791367155696E-01,
            -8.765720202742479E-01,
            -8.435882616243935E-01,
            -8.070662040294426E-01,
            -7.671590325157404E-01,
            -7.240341309238146E-01,
            -6.778723796326639E-01,
            -6.288673967765136E-01,
            -5.772247260839727E-01,
            -5.231609747222330E-01,
            -4.669029047509584E-01,
            -4.086864819907167E-01,
            -3.487558862921608E-01,
            -2.873624873554556E-01,
            -2.247637903946891E-01,
            -1.612223560688917E-01,
            -9.700469920946270E-02,
            -3.238017096286936E-02,
             3.238017096286936E-02,
             9.700469920946270E-02,
             1.612223560688917E-01,
             2.247637903946891E-01,
             2.873624873554556E-01,
             3.487558862921608E-01,
             4.086864819907167E-01,
             4.669029047509584E-01,
             5.231609747222330E-01,
             5.772247260839727E-01,
             6.288673967765136E-01,
             6.778723796326639E-01,
             7.240341309238146E-01,
             7.671590325157404E-01,
             8.070662040294426E-01,
             8.435882616243935E-01,
             8.765720202742479E-01,
             9.058791367155696E-01,
             9.313866907065543E-01,
             9.529877031604309E-01,
             9.705915925462473E-01,
             9.841245837228269E-01,
             9.935301722663508E-01,
             9.987710072524261E-01,
        ]),
        "wi": np.array([
            3.153346052305838E-03,
            7.327553901276262E-03,
            1.147723457923454E-02,
            1.557931572294385E-02,
            1.961616045735553E-02,
            2.357076083932438E-02,
            2.742650970835695E-02,
            3.116722783279809E-02,
            3.477722256477044E-02,
            3.824135106583071E-02,
            4.154508294346475E-02,
            4.467456085669428E-02,
            4.761665849249048E-02,
            5.035903555385447E-02,
            5.289018948519367E-02,
            5.519950369998416E-02,
            5.727729210040321E-02,
            5.911483969839564E-02,
            6.070443916589388E-02,
            6.203942315989266E-02,
            6.311419228625402E-02,
            6.392423858464819E-02,
            6.446616443595009E-02,
            6.473769681268392E-02,
            6.473769681268392E-02,
            6.446616443595009E-02,
            6.392423858464819E-02,
            6.311419228625402E-02,
            6.203942315989266E-02,
            6.070443916589388E-02,
            5.911483969839564E-02,
            5.727729210040321E-02,
            5.519950369998416E-02,
            5.289018948519367E-02,
            5.035903555385447E-02,
            4.761665849249048E-02,
            4.467456085669428E-02,
            4.154508294346475E-02,
            3.824135106583071E-02,
            3.477722256477044E-02,
            3.116722783279809E-02,
            2.742650970835695E-02,
            2.357076083932438E-02,
            1.961616045735553E-02,
            1.557931572294385E-02,
            1.147723457923454E-02,
            7.327553901276262E-03,
            3.153346052305838E-03,
        ]),
    },
    64: {
        "xi": np.array([
            -9.993050417357722E-01,
            -9.963401167719553E-01,
            -9.910133714767443E-01,
            -9.833362538846260E-01,
            -9.733268277899110E-01,
            -9.610087996520538E-01,
            -9.464113748584028E-01,
            -9.295691721319396E-01,
            -9.105221370785028E-01,
            -8.893154459951141E-01,
            -8.659993981540928E-01,
            -8.406292962525803E-01,
            -8.132653151227975E-01,
            -7.839723589433414E-01,
            -7.528199072605319E-01,
            -7.198818501716109E-01,
            -6.852363130542333E-01,
            -6.489654712546573E-01,
            -6.111553551723933E-01,
            -5.718956462026340E-01,
            -5.312794640198946E-01,
            -4.894031457070530E-01,
            -4.463660172534641E-01,
            -4.022701579639916E-01,
            -3.572201583376681E-01,
            -3.113228719902110E-01,
            -2.646871622087674E-01,
            -2.174236437400071E-01,
            -1.696444204239928E-01,
            -1.214628192961206E-01,
            -7.299312178779904E-02,
            -2.435029266342443E-02,
             2.435029266342443E-02,
             7.299312178779904E-02,
             1.214628192961206E-01,
             1.696444204239928E-01,
             2.174236437400071E-01,
             2.646871622087674E-01,
             3.113228719902110E-01,
             3.572201583376681E-01,
             4.022701579639916E-01,
             4.463660172534641E-01,
             4.894031457070530E-01,
             5.312794640198946E-01,
             5.718956462026340E-01,
             6.111553551723933E-01,
             6.489654712546573E-01,
             6.852363130542333E-01,
             7.198818501716109E-01,
             7.528199072605319E-01,
             7.839723589433414E-01,
             8.132653151227975E-01,
             8.406292962525803E-01,
             8.659993981540928E-01,
             8.893154459951141E-01,
             9.105221370785028E-01,
             9.295691721319396E-01,
             9.464113748584028E-01,
             9.610087996520538E-01,
             9.733268277899110E-01,
             9.833362538846260E-01,
             9.910133714767443E-01,
             9.963401167719553E-01,
             9.993050417357722E-01,
        ]),
        "wi": np.array([
            1.783280721696433E-03,
            4.147033260562468E-03,
            6.504457968978363E-03,
            8.846759826363947E-03,
            1.116813946013113E-02,
            1.346304789671864E-02,
            1.572603047602472E-02,
            1.795171577569734E-02,
            2.013482315353021E-02,
            2.227017380838325E-02,
            2.435270256871087E-02,
            2.637746971505466E-02,
            2.833967261425948E-02,
            3.023465707240248E-02,
            3.205792835485155E-02,
            3.380516183714161E-02,
            3.547221325688239E-02,
            3.705512854024005E-02,
            3.855015317861563E-02,
            3.995374113272034E-02,
            4.126256324262353E-02,
            4.247351512365359E-02,
            4.358372452932345E-02,
            4.459055816375657E-02,
            4.549162792741814E-02,
            4.628479658131442E-02,
            4.696818281621002E-02,
            4.754016571483031E-02,
            4.799938859645831E-02,
            4.834476223480295E-02,
            4.857546744150343E-02,
            4.869095700913972E-02,
            4.869095700913972E-02,
            4.857546744150343E-02,
            4.834476223480295E-02,
            4.799938859645831E-02,
            4.754016571483031E-02,
            4.696818281621002E-02,
            4.628479658131442E-02,
            4.549162792741814E-02,
            4.459055816375657E-02,
            4.358372452932345E-02,
            4.247351512365359E-02,
            4.126256324262353E-02,
            3.995374113272034E-02,
            3.855015317861563E-02,
            3.705512854024005E-02,
            3.547221325688239E-02,
            3.380516183714161E-02,
            3.205792835485155E-02,
            3.023465707240248E-02,
            2.833967261425948E-02,
            2.637746971505466E-02,
            2.435270256871087E-02,
            2.227017380838325E-02,
            2.013482315353021E-02,
            1.795171577569734E-02,
            1.572603047602472E-02,
            1.346304789671864E-02,
            1.116813946013113E-02,
            8.846759826363947E-03,
            6.504457968978363E-03,
            4.147033260562468E-03,
            1.783280721696433E-03, 
        ]),
    },
}

def Telles_function(ξ, w, r_bar):
    def Telles(eta_bar):
    
        p = (
            1
            / (3 * (1 + 2 * r_bar) ** 2)
            * (4 * r_bar * (1 - r_bar) + 3 * (1 - eta_bar**2))
        )
        
        q = (
            1
            / (2 * (1 + 2 * r_bar))
            * ((eta_bar * (3 - 2 * r_bar) - (2 * eta_bar**3 / (1 + 2 * r_bar)))
            / (1 + 2 * r_bar) - eta_bar)
        )
    
        term1 = np.cbrt(-q + np.sqrt(q**2 + p**3))
        term2 = np.cbrt(-q - np.sqrt(q**2 + p**3))
        
        γ_bar = term1 + term2 + eta_bar / (1 + 2 * r_bar)
    
        Q = 1 + 3 * γ_bar**2
    
        
        
        a = (1 - r_bar)/Q
        b = -3 * (1 - r_bar)*γ_bar / Q
        c = (r_bar + 3*γ_bar**2)/ Q
        d = -b
    
        
        ξ_bar = a * ξ**3 + b * ξ.T**2 + c * ξ + d
        w_bar = w*(3 * a * ξ**2 + 2 * b * ξ+ c)
    
        return ξ_bar, w_bar
    return Telles